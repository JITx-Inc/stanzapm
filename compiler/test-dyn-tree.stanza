defpackage test-dyn-tree :
  import core
  import collections
  import stz/dyn-tree

defn main () :
  val listen = new TreeListener :
    defmethod leaves-changed (this, n:Int) :
      println("Leaves of %_ changed." % [n])
    defmethod parents-changed (this, n:Int) :
      println("Parents of %_ changed." % [n])

  val t = DynTree()
  add(t, listen)
  defn print-state (name) :
    println(name)
    println(t)
    for i in 1 through 7 do :
      println("All leaves of %_ = %," % [i, all-leaves(t,i)])
      println("All parents of %_ = %," % [i, all-parents(t,i)])

  add(t, [
    NodeState(1, [], [2, 3, 4], false)
    NodeState(2, [], [], true)
    NodeState(3, [], [5,6], false)
    NodeState(4, [], [], false)
    NodeState(5, [], [], false)
    NodeState(6, [], [], false)
    NodeState(7, [5,6], [], true)
  ])
  print-state("Initial Tree")

  add(t, [
    NodeState(7, [4,5], [], true)
    NodeState(1, [], [3,4], false)
    NodeState(2, [3], [], true)
  ])
  print-state("After Moving")

  add(t, [
    NodeState(3, [], [2,5,6], false)
    NodeState(2, [], [], true)])
  print-state("Done")   

main()